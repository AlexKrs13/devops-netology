## Типы и структура СУБД

### Задача 1
```text
Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определенных данных.
Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:
* Электронные чеки в json виде
* Склады и автомобильные дороги для логистической компании
* Генеалогические деревья
* Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
* Отношения клиент-покупка для интернет-магазина
Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.
```
#### Выберите подходящие типы СУБД для каждой сущности:
__1.1. Электронные чеки в json виде__  
* Если отвечать на вопрос теоретически, то лучшим вариантом, на мой взгляд, будет NoSQL СУБД - MongoDB.  
> Одним из популярных стандартов обмена данными и их хранения в MongoDB является JSON (JavaScript Object Notation).  
JSON эффективно описывает сложные по структуре данные. Способ хранения данных в MongoDB в этом плане похож на JSON, хотя формально JSON не используется.  
Для хранения в MongoDB применяется формат, который называется BSON (БиСон) или сокращение от binary JSON.  
BSON позволяет работать с данными быстрее: быстрее выполняется поиск и обработка. Хотя надо отметить, что BSON в отличие от хранения данных в формате JSON имеет небольшой недостаток: в целом данные в JSON-формате занимают меньше места, чем в формате BSON, с другой стороны, данный недостаток с лихвой окупается скоростью.

* На практике может легко применяться и SQL СУБД   
> В PostgreSQL имеются два типа для хранения данных JSON: json и jsonb. Для реализации эффективного механизма запросов к этим типам данных в PostgreSQL также имеется тип jsonpath.
Для работы с ними есть также несколько специальных функций и операторов.

* Если поток сообщений большой - десятки и сотни тысяч сообщений в секунду (в масштабах страны), то можно и брокер kafka использовать.
Далее сообщения вычитывать и сохранять в целевую структуру, например, на greenplum или hadoop.

__1.2. Склады и автомобильные дороги для логистической компании__  
SQL СУБД. Если нужно работать с географическими координатами, строить кратчайший поиск пути на графе - стоит выбрать Postgres. К нему можно дополнительные модули поставить, например, PostGIS.

__1.3. Генеалогические деревья__  
Есть специализированный класс NoSQL решений - графовые СУБД: Neo4j, OrientDB   

__1.4. Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации__  
NoSQL решения - key-value хранилища, такие как Memcached или Redis  

__1.5. Отношения клиент-покупка для интернет-магазина__  
Любые реляционные СУБД. Думаю, что самым популярным вариантом в этом сегменте является MySQL.  

### Задача 2
```text
Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если (каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

* Данные записываются на все узлы с задержкой до часа (асинхронная запись)
* При сетевых сбоях, система может разделиться на 2 раздельных кластера
* Система может не прислать корректный ответ или сбросить соединение
А согласно PACELC-теореме, как бы вы классифицировали данные реализации?
```
__2.1. Данные записываются на все узлы с задержкой до часа (асинхронная запись)__  
В системе класса AP не гарантируется целостность, но при этом выполнены условия доступности и устойчивости к разделению.  
AP-система может быть представлена кластером из нескольких узлов, каждый из которых может принимать данные, но не обязуется в тот же момент распространять их на другие серверы.  
PA/EL - при разделении сети они отказываются от согласованности для большей доступности, а при нормальной работе отказываются от согласованности для более низкой задержки.    

__2.2. При сетевых сбоях, система может разделиться на 2 раздельных кластера__  
AP - по идее, если система развалится на два отдельных кластера, то согласованность данных не может быть обеспечена, но при этом оба кластера будут отвечать на запросы и быть доступны.  
PA/EL, но возможно и PA/EC, но не уверен.


__2.3. Система может не прислать корректный ответ или сбросить соединение__  
Система класса CP в каждый момент обеспечивает целостный результат и способна функционировать в условиях разделения, но достигает этого в ущерб доступности: может не выдавать отклик на запрос.  
PC/EC - такие системы будут жертвовать доступностью в угоду консистентности.

### Задача 3
```text
Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?
```
Думаю ответ нет.  
В модели BASE почти полностью отказываются от требований согласованности модели ACID.  
Одна из основных концепций, лежащих в основе BASE, заключается в том, что согласованность данных является проблемой разработчика и не должна обрабатываться базой данных.

### Задача 4
```text
Вам дали задачу написать системное решение, основой которого бы послужили:
фиксация некоторых значений с временем жизни
реакция на истечение таймаута
Вы слышали о key-value хранилище, которое имеет механизм Pub/Sub. Что это за система? Какие минусы выбора данной системы?
```
#### Подходящей системой является Redis:  
* in-memory key-value хранилище
* поддержка модели Pub/Sub
#### Минусы Redis:   
https://redis.io/docs/management/troubleshooting/  
* Latency issues  
Для настроек производительности, задержек и надежности требуется соблюдать компромиссы (описанные в документе) между надежностью и задержкой/производительностью, в порядке от большей безопасности к лучшей задержке.  
https://redis.io/docs/management/optimization/latency/  
* Broken RAM  
В случае нестабильной работы Redis или частыми сбоями требуется проводить тестирование RAM  
* Persistence  
По умолчанию redis сохраняет базу на диск с определенными интервалами. Чем чаще будет выполняться обращение к диску, тем сильнее это повлияет на производительность.  
Поэтому при настройке рекомендуется соблюдать баланс производительности и надежности, а именно принять возможные риски потери последних данных.  
https://redis.io/docs/management/persistence/  
```
"Основной минус, как мне кажется, это поддержка персистентности" - только сейчас увидел, что я написал. Извиняюсь, писал уже ночью.
Хотел сказать, что сам механизм не дает 100% гарантии на сохранность записей в БД при завершении процесса, если Redis не успел заснепшотить БД на диск.
https://redis.io/docs/management/persistence/

"Настройка шардирования требуют глубокого понимания предметной области специалистом. - вы когда копипастите что то откудато, пытаетесь понять о чем речь? я вот не не понял, расшифруйте"
Что такое шардирование я знаю, долго работал с GreenPlum.
Когда гуглил про минусы Redis, то вспомнил про шардирование и подумал, а поддерживает ли Redis механизм распределения ключей по нодам кластера по определенному алгоритму.
И не нашел подтверждения что redis так умеет из коробки.

"Еще читал, что отсутствует полноценная поддержка виртуальной памяти (функция не рекомендована разработчиками к использованию) - чего чего? подробней можно?" - а вот это я точно в инте целиком взял.
Еще раз погуглил, это старющие ссылки от 2011-2012 годов: https://groups.google.com/g/redis-db/c/U7s1ly-DReo или https://groups.google.com/g/redis-db/c/PFduIz3fs_k
https://stackoverflow.com/questions/5068518/what-does-redis-do-when-it-runs-out-of-memory
Уже устарело: https://redis.io/docs/reference/internals/internals-vm/
Пора прекращать делать лабы по ночам.
```